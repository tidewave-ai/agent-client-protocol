---
title: "Session Resume"
---

<!--

Instructions:

* Copy this file and give it a name like my-feature-slug.mdx
* Do not remove the `>` sections -- they are part of the template!
* Replace the HTML comments that give general guidance with your answers and content. Do not begin your answers with `>`, your text should be unquoted.
* For optional sections, you can leave the HTML comment as is if you do not wish to provide an answer.
* In the FAQ, begin each question with a markdown `##` section so that it gets a linkable anchor.

-->

- Author(s): [@SteffenDE](https://github.com/SteffenDE)

## Elevator pitch

> What are you proposing to change?

<!--
    Give a brief, high-level overview of what you plan to do and what problem you are solving. Feel free to use bullet points to help clarify the structure.
-->

Currently, no agent supports `session/load`. One hurdle in implementing this is that the used agent SDKs do not have an API to properly implement it.
For example, Claude Code offers a parameter to "resume" a session based on an ID, but it doesn't have a way to get the session content.
Therefore, implementing `session/load` would require persistent state in the `claude-code-acp` wrapper. This means that right now, there's no
way to actually continue old chats using ACP with any of the big agents (Claude Code, Codex, Gemini). I'm proposing to implement a lighter
`session/resume` operation that only requires a "resume token" and does not echo back any old session content, making it easier to implement
for the current agents.

## Status quo

> How do things work today and what problems does this cause? Why would we change things?

Right now, to resume sessions an agent needs to store the user and agent message chunks and echo them back on `session/load`.
No big agent implements this yet.

## What we propose to do about it

> What are you proposing to improve the situation?

<!--
    Use this section to describe what you propose to do at a high-level.
    Don't give every detail, this should be the high-level summary.

    Note: This section is OPTIONAL when RFDs are first opened.
    You can also include multiple variants if you have different ideas of how to approach the problem, though these should be narrowed down as the RFD progresses.
-->

Add `session/resume` operation, which is an optional new method with a more lightweight contract.

## Shiny future

> How will things will play out once this feature exists?

<!--
    Use this section to describe the "status quo" as it will play out once
    we have made these changes.

    Note: This section is OPTIONAL when RFDs are first opened.
-->

I created a [proof of concept](https://github.com/zed-industries/claude-code-acp/pull/145) that makes this work with Claude Code. The idea is that clients that currently already store session
information themselves have a way to continue chats.

## Implementation details and plan

> Tell me more about your implementation. What is your detailed implementation plan?

<!--
    Use this section to add details that were not covered in the "What we propose to do about it" section and also include an implementation plan with phases.

    Note: This section is OPTIONAL and NOT RECOMMENDED when RFDs are first opened. It can distract from the discussion of the problem.
-->

I've only looked at Claude Code in detail so far. One difficulty with `session/load`, apart from keeping message chunks, is that ACP creates
the session ID before the first message is sent, but Claude Code only returns its session ID after the first message. Therefore, the ACP
`sessionId` and Claude's internal session ID are not the same, but for resuming a chat the client needs to pass Claude's session ID somehow.

Therefore, I propose to decouple resumption from the `sessionId`, and instead allow the agent to provide a `resumeToken` (or similar) that is
sent using a notification and - in theory - can also be updated any time by the agent if necessary:

```json
{
    "method": "session/resume_token",
    "params": {
        "sessionId": "ACP-SESSION-ID",
        "resumeToken": "AGENT-SPECIFIC-TOKEN"
    },
    "jsonrpc": "2.0"
}
```

Then, to resume a session - after initialization - the client can send a:

```json
{
    "method": "session/resume",
    "params": {
        "resumeToken": "AGENT-SPECIFIC-TOKEN",
        "cwd": ...,
        "mcpServers": [...],
        ... // any other params from session/new
    },
    "jsonrpc": "2.0"
}
```

The agent then either responds with an error, or with the same response as `session/new`. The agent may create a new ACP session ID - but
this is very much up for discussion.

## Frequently asked questions

> What questions have arisen over the course of authoring this document or during subsequent discussions?

<!--
    Keep this section up-to-date as discussion proceeds. The goal is to capture major points that came up on a PR or in a discussion forum -- and if they reoccur, to point people to the FAQ so that we can start the dialog from a more informed place.
-->

### What alternative approaches did you consider, and why did you settle on this one?

Implementing full `session/load` for `claude-code-acp`, by storing chunks in the filesystem and also tracking the Claude session ID on disk.

<!-- You...may want to adjust this. -->

## Revision history

<!-- If there have been major updates to this RFD, you can include the git revisions and a summary of the changes. -->
